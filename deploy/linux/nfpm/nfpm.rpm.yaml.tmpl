name: ng-gateway
arch: {{RPM_ARCH}}
platform: linux
version: {{PKG_VERSION}}
# NOTE:
# We publish a single RPM artifact (no el7/el8 split). Actual runtime compatibility
# depends on the binary/plugin ABI (glibc/OpenSSL), not only on metadata.
release: "1"
maintainer: "NG Gateway CI <ci@users.noreply.github.com>"
description: "High-throughput IoT gateway (NG Gateway)"
homepage: "https://github.com/shiyuecamus/ng-gateway"
license: "Apache-2.0"

# Runtime dependencies (RHEL-family best-effort baseline).
#
# We intentionally depend on *library* packages (e.g. sqlite-libs) rather than CLI tools.
depends:
  - ca-certificates
  - systemd

contents:
  # Create install root directory explicitly.
  - src: {{ROOTFS_DIR}}/opt/ng-gateway
    dst: /opt/ng-gateway
    type: dir

  # Install binary + default config.
  - src: {{ROOTFS_DIR}}/opt/ng-gateway/bin/ng-gateway-bin
    dst: /opt/ng-gateway/bin/ng-gateway-bin
  - src: {{ROOTFS_DIR}}/opt/ng-gateway/gateway.toml
    dst: /opt/ng-gateway/gateway.toml

  # Builtin drivers/plugins (may include a `.keep` placeholder).
  - src: {{ROOTFS_DIR}}/opt/ng-gateway/drivers/builtin/*
    dst: /opt/ng-gateway/drivers/builtin/
  - src: {{ROOTFS_DIR}}/opt/ng-gateway/plugins/builtin/*
    dst: /opt/ng-gateway/plugins/builtin/

  - src: {{SYSTEMD_UNIT}}
    dst: /usr/lib/systemd/system/ng-gateway.service
  - src: {{ROOTFS_DIR}}/etc/ng-gateway
    dst: /etc/ng-gateway
    type: dir
  - src: {{ROOTFS_DIR}}/var/lib/ng-gateway
    dst: /var/lib/ng-gateway
    type: dir

scripts:
  postinstall: {{POSTINSTALL}}
  preremove: {{PREREMOVE}}

